<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Import Google Icon Font -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Compiled and minified CSS from Materialize -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Compiled and minified JavaScript from Materialize -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <!-- Link to your custom CSS file -->
    <link rel="stylesheet" type="text/css" href="styles.css">

    <!-- Link to import highlight css format of code boxes -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism.min.css" rel="stylesheet" />


    <title>Main Tutorial</title>
</head>

<body class="lime lighten-4">
    <!-- Navigation Bar -->
    <div class="navbar-fixed ">
        <nav class="blue-grey darken-3 lime darken-4">
            <ul class="center-nav-items">
                <li><a href="/public/index.html">Home</a></li>
                <li><a href="/public/main.html">Node Tutorial</a></li>
                <li><a href="#">What is an API?</a></li>
                <li><a href="#">What is NodeJS</a></li>
            </ul>
        </nav>
      </div>

    <!-- Main Tutorial Introduction -->
    <div class="container">
        <div class="card-panel green darken-3 z-depth-2">
            <h4 class="white-text">
                Introduction
                <i class="material-icons right white-text">lightbulb_outline</i>
            </h4>
            <p class="white-text">
                In this tutorial, we will explore how to consume web services through Node.js. This guide is divided into three comprehensive parts, alongside a practical example that integrates all the concepts discussed. The structure of each of the parts
                consists in a concise and brief explanation, followed by an example with our node js application in which we are using 3 apis: OpenAi, Spotify and a news api. 
            </p>
           
        </div>

        <!-- Detailed Tutorial Sections -->
        <!-- Part 1 -->
        <div class="section card-panel light-green lighten-2 hoverable">
            <h3>Part 1: Introduction to Web Services and Node.js</h3>
            <p>This section will introduce web services and their importance in modern web development. We'll also dive into Node.js fundamentals and API explanation.</p>
            <h5><i class="tiny material-icons">chevron_right</i>What is Node.js?</h5>
            <ul>
                  <li><i class="tiny material-icons">check_circle</i>Node.js is a server environment</li>
                  <li><i class="tiny material-icons">check_circle</i>Node.js uses JavaScript outside the browser, in other words it uses JavaScript in the server side</li>
                  <li><i class="tiny material-icons">check_circle</i>Node.js enables us to use JavaScript in both client side and server side</li>
                </ul>
            <h5><i class="tiny material-icons">chevron_right</i>What is an API?</h5>
            <ul>
                <li><i class="tiny material-icons">check_circle</i>API stands for Application Programming Interface.</li>
                <li><i class="tiny material-icons">check_circle</i>It is a set of rules that allows programs to communicate with each other.</li>
                <li><i class="tiny material-icons">check_circle</i>APIs define methods of requesting services from an application or software component.</li>
                <li><i class="tiny material-icons">check_circle</i>They enable integration between different software systems, often over a network.</li>
                <li><i class="tiny material-icons">check_circle</i>APIs can be used to access web-based services, databases, or other resources.</li>
                <li><i class="tiny material-icons">check_circle</i>They provide a layer of security, hiding the details of database or service internals.</li>
                <li><i class="tiny material-icons">check_circle</i>Commonly used in building RESTful web services and applications.</li>
              </ul>
              <img src="img/mesero.png" class="centered-image">
              <p>
                Consider an API as a waiter who manages the orders we (the clients) place, and relays those requests to the chef (the server). Once the chef prepares our meal, the waiter delivers it to us. This allows us to enjoy our meal without needing to understand the intricacies of how it was prepared.
              </p>
              <h5>HTTP methods</h5>
              
             
            
              
              <p>
                <strong>GET Method:</strong> Imagine you're at a restaurant and you ask the waiter for the menu. The waiter (API) brings the menu to you (the client) from the kitchen (the server). This is like a <code>GET</code> request, where you're requesting to see information. In web terms, it's used to retrieve data from a server at the specified resource. 
              </p>
              
              <p>
                <strong>POST Method:</strong> After deciding what you want, you tell the waiter your order. The waiter then conveys your order to the kitchen, where your meal is prepared. This resembles a <code>POST</code> request, where you're sending data (your order) to the server for it to process and store. In web terms, <code>POST</code> is used to submit data to be processed to a specified resource.
              </p>
              <p> We are too lazy to explain the other HTTP methods but our friend Fireship isn't, you will not need other methods for this tutorial
                but its always exciting to learn. 
              </p>
              <iframe width="560" height="315" src="https://www.youtube.com/embed/-MTSQjw5DrM?si=5EZ6ol0pfNDrKEQy" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen class="centered-image"></iframe>
              

        </div>

        <!-- Part 2 -->
        <div class="section card-panel light-green lighten-2" >
            <h3>Part 2: Consuming Web Services Using Node.js</h3>
            <p>In the second part, we'll cover how to use Node.js to make requests to web services. We'll focus how to use fetch  to interact 
              with APIs, handle different responses and process JSON data. 
            </p>
            <p>Okay then, by far you should have a notion of what is an api, what is node js and what are http methods, now its time to put this into practice</p>
            <h4>Step by step:</h4>
            <h5><i class="tiny material-icons">beenhere</i>Step 1: Intro </h5>
            <p>Firstly, we need to decide which APIs to use, based on our goals. For a project that involves philosophical analysis of songs and fetching news articles about the artists, we'll use the Spotify API for music data, OpenAI API for generating reflections, and GNews API for news articles.</p>
            <h5><i class="tiny material-icons">beenhere</i>Step 2: Intro </h5>
            After identifying our API choices and objectives, we're ready to dive into consuming web services with Node.js.</p>
            <h5><i class="tiny material-icons">beenhere</i>Step 3: Generating a spotify token.  </h5>
            <p>Our first task is to obtain a Spotify token, which is essential for making queries to Spotify's API for song and artist information. Below is the code to request a token:</p>
          
            <div class="card">
              <div class="card-content">
                <span class="card-title">Generating token script</span>
                <pre><code class="language-javascript">
                  async function getSpotifyToken() {
                    const requestOptions = {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: `grant_type=client_credentials&client_id=${client_id}&client_secret=${client_secret}`
                    };
                    const response = await fetch(endpoint_spotify, requestOptions);
                    const data = await response.json();
                    return data.access_token;
                }
                </code></pre>
              </div>
            </div>
            <h6>POST method explanation:</h6>

    
            <p>The <code>POST</code> method is used in the <code>getSpotifyToken</code> function for several reasons:</p>
            <ul>
                <li><strong>Submitting Data:</strong> The <code>POST</code> method is designed to submit data to a specified resource to be processed. In this case, it sends the client credentials to the Spotify API to request an access token.</li>
                <li><strong>Security:</strong> <code>POST</code> requests submit data in the body of the request. This is more secure than a <code>GET</code> request, which appends data to the URL, because sensitive information like the client ID and client secret are not exposed in URLs that could be logged or cached.</li>
                <li><strong>Semantic Correctness:</strong> The action of obtaining an access token alters the state on the server by creating a new token or refreshing an existing one. According to HTTP method definitions, <code>POST</code> is appropriate for operations that cause changes on the server.</li>
                <li><strong>Accommodating Payloads:</strong> Unlike <code>GET</code> requests, which are limited in size and restricted to URL length, <code>POST</code> requests can carry a larger amount of data in the request body. This function sends a payload containing the grant type, client ID, and client secret, which are necessary for the authentication process.</li>
            </ul>
            <p>In summary, the <code>POST</code> method is used in this function to securely submit authentication details to the Spotify API, requesting an access token while adhering to best practices for web communication.</p>
            <h5><i class="tiny material-icons">beenhere</i>Step 4: Making our first query to spotify API.</h5>
            <p>Once we obtain the Spotify token, we will execute two queries. The first query will return the name of the song and the artist who performed it and the second one will return only the name of the artist, this is becasue we need to separate our responses for future implementations. This data will then be utilized to enable in-depth analysis with OpenAI and to get news about the artists.</p>
            <p>The code utilizing the Spotify token to execute the query can be observed in the subsequent code box:</p>



            <div class="card">
              <div class="card-content">
                <span class="card-title">Spotify query script</span>
                <pre><code class="language-javascript">
                  //Async Function to do spotify querys about the song and artist name.
                  async function searchSpotifySong(token, songName) {
                    const requestOptions = {
                        method: 'GET',
                        headers: { 'Authorization': 'Bearer ' + token }
                    };
                    const query = encodeURIComponent(songName);
                    const endpoint = `https://api.spotify.com/v1/search?q=${query}&type=track`;
                    const response = await fetch(endpoint, requestOptions);
                    const data = await response.json();
                    if (data.tracks.items.length > 0) {
                        const artist_name = data.tracks.items[0].artists[0].name
                        const song_name = data.tracks.items[0].name
                        console.log("Song name and artist grabbed from Spotify: ")
                        return `${song_name} by ${artist_name} \n`
                        
                    }
                    throw new Error('Song not found');
                  }

                  //Async Function to do spotify querys about the artist name.
                  async function getArtistName (token, songName) {
                    const requestOptions = {
                        method: 'GET',
                        headers: { 'Authorization': 'Bearer ' + token }
                    };
                    const query = encodeURIComponent(songName);
                    const endpoint = `https://api.spotify.com/v1/search?q=${query}&type=track`;
                    const response = await fetch(endpoint, requestOptions);
                    const data = await response.json();
                    if (data.tracks.items.length > 0) {
                        const artist_name = data.tracks.items[0].artists[0].name
                        return artist_name
                        
                    }
                    throw new Error('Song not found');
                
                }
                </code></pre>
              </div>
            </div>
            <h6>GET method explanation:</h6>
            <p>The GET method is used in these functions to request data from the Spotify API. Specifically, it's employed to fetch information about a song and its artist, or just the artist's name, based on the song name provided by the user. The use of the GET method here is appropriate because we are retrieving information, not sending or modifying data on the server.</p>

<p>When we make a request with the GET method, we append the search query (the song name, encoded to be URL-safe) to the endpoint URL. This is followed by specifying the type of data we're looking for, which in this case is 'track', to indicate we're searching for song tracks. The authorization header, containing the Bearer token, authenticates our request to the Spotify API.</p>

<p>In return, the Spotify API responds with a JSON object containing details about the tracks that match the query. This object includes a variety of information, but we're particularly interested in the 'items' array within the 'tracks' object, which lists the songs that fit the search criteria. From the first item in this array, we extract the song's name and the primary artist's name. These pieces of information are then used to log the song and artist or are returned for further processing. If no matching tracks are found, an error indicating "Song not found" is thrown, signaling that the search did not yield any results.</p>

<p>This method of querying allows us to efficiently retrieve and utilize specific data from Spotify's vast library for our application's needs, such as generating insights or finding related news articles.</p>
<h5><i class="tiny material-icons">beenhere</i>Step 5: Making our first Open AI query</h5>
<p>With the song name and the artist name that we got of the last step, we can now do our first query to Open AI API to achieve the purpose we mentioned before. Passing the song name and artist name as paramters to the LLM call</p>
<p>We can see the request of the deep reflection and the request for the news about the song in the following Async functions:</p>
            <div class="card">
              <div class="card-content">
                <span class="card-title">Open AI & GNews query script</span>
                <pre><code class="language-javascript">
                  //Async Function to to do Open AI querys about deep reflection.
                  async function getOpenAIReflection(song_name_and_artist) {
                    const body = JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [{ "role": "user", "content": `Give me a deep philosophical reflection about ${song_name_and_artist}.` }]
                    });
                    const requestOptions = {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer useyourkeyhere' },
                        body: body
                    };
                    const response = await fetch(endpoint_ai, requestOptions);
                    const data = await response.json();
                    console.log("Philosophical Reflection generated by gpt-3.5-turbo: ")
                    return data.choices[0].message.content;
                }
                //Async Function to do Google News querys about news articles of the artist.
                async function fetchNewsArticlesAboutSong(songInfoNews) {
                    const apikey = 'Put here your Open AI key';
                    const encodedSongInfo = encodeURIComponent(songInfoNews); // Ensure the song info is URL-safe
                    const url = `https://gnews.io/api/v4/search?q=${encodedSongInfo}&lang=en&country=us&max=10&apikey=${apikey}`;
                
                    try {
                        const response = await fetch(url);
                        const data = await response.json();
                        const articles = data.articles;
                
                        console.log(`News Related to "${songInfoNews}":`);
                        
                
                        for (let i = 0; i < articles.length; i++) {
                            console.log(`New ${i}: ${articles[i]['title']}`);
                            console.log(`Description: ${articles[i]['description']}`);
                            console.log("\n");
                            // To display all articles, remove the break statement below.
                            break;
                
                        }
                    
                    } catch (error) {
                        console.log('Error fetching news articles:', error);
                    }
                }
                </code></pre>
              </div>
            </div>
            <h6>POST method explanation:</h6>
            <p> This section of the code provides another illustration of the POST method, this time in interaction with the OpenAI API. We employ this method to query OpenAI to perform a deep reflection based on the name of a song and its corresponding artist. The use of the POST method is crucial here as it enables us to request OpenAI to generate thoughtful insights about a specific song and artist.</p>

            
            
        </div>

        <!-- Part 3 -->
        <div class="section card-panel light-green lighten-2 hoverable">
            <h3>Part 3: Making everything work with each other </h3>
            <p>Great!, by far we should understand what is an api how to fetch data through differnt apis and how top treat JSON reposnes, we are only missing the connections between these doots to maake the apis interact with each other</p>
            <h5><i class="tiny material-icons">beenhere</i>Step 6: Making an Async function to call the prevoius functions and display the results</h5>
            <p>In this final step, we will execute an asynchronous function that calls all previously mentioned asynchronous functions and establishes a relationship between them. This connection will enable the 'deep reflection' and 'news articles' functions to fulfill their intended purposes. In other words, it will make the generation of deep reflections and news articles about the artist.</p>
            <div class="card">
              <div class="card-content">
                <span class="card-title">Script that makes the magic happen:</span>
                <pre><code class="language-javascript">
                  (async () => {
                    try {
                        const songToAnalyze = "Poker Face"
                        const token = await getSpotifyToken();
                        const song_info = await searchSpotifySong(token, songToAnalyze);
                        console.log(song_info)
                        const reflection = await getOpenAIReflection(song_info);
                        console.log(reflection);
                        console.log("\n")
                        const artistNameForNews = await getArtistName(token, songToAnalyze)
                        await fetchNewsArticlesAboutSong(artistNameForNews)
                    } catch (error) {
                        console.log('Error:', error.message);
                    }
                  })();
                </code></pre>        

              </div>
               
            </div>
            <p>We are fundamentally setting up a song for analysis, as our Node.js application currently lacks a frontend interface. Initially, the spotifyToken function is executed to obtain an authentication token. With this token, we then query Spotify to find details about the song and its artist. After acquiring the names of the song and artist, these are passed as parameters to the OpenAI function. This function is tasked with generating a philosophical analysis of the song through a specific prompt. Lastly, we use the artist's name as a parameter to fetch news articles related to the artist, thereby enriching our analysis with current information.</p>
        </div>
        <h3 class="center-align">Great You are Now a NodeJS and API ninja!!</h3>
    </div>

    <!-- Compiled and minified JavaScript at the end of the body for optimized loading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <!-- LINK TO IMPORT TH JS FILE TO ENABLE STYLES IN BOX CODE-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-javascript.min.js"></script>
</body>

</html>

